<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XROT95 Ultimate Manual</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a0a0a">
  <style>
    :root { --bg: #0a0a0a; --panel: #111; --accent: #18f0ff; --danger: #ff3256; --warn: #f5cb42; --fg: #f1f1f1; --border: #333; --radius: 8px; }
    * { box-sizing:border-box; }
    body { margin:0; background:var(--bg); color:var(--fg); font-family:sans-serif; display:flex; flex-direction:column; min-height:100vh; }
    header { background:#000; border-bottom:1px solid var(--border); padding:15px; display:flex; justify-content:space-between; align-items:center; }
    h1 { font-size:1.1rem; color:var(--accent); margin:0; text-transform:uppercase; letter-spacing:1px; }
    #status { font-size:0.8rem; color:var(--warn); display:none; }
    main { flex:1; padding:20px; display:flex; flex-direction:column; align-items:center; }
    
    /* Grid */
    #machineSelector { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; width:100%; max-width:1200px; }
    .card { background:var(--panel); border:1px solid var(--border); padding:20px; border-radius:var(--radius); text-align:center; cursor:pointer; transition:0.2s; }
    .card:active { transform:scale(0.98); border-color:var(--accent); }
    .badge { background:var(--accent); color:#000; padding:2px 6px; font-size:0.7rem; border-radius:4px; text-transform:uppercase; margin-left:5px; }

    /* Module View */
    #moduleShell { display:none; width:100%; max-width:1200px; }
    #moduleHeader { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:10px; }
    button { background:var(--accent); color:#000; border:none; padding:8px 16px; border-radius:4px; font-weight:bold; }
    
    /* Error Box */
    .error-box { color: var(--danger); background: rgba(255,50,86,0.1); border: 1px solid var(--danger); padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; margin-top: 20px; }
  </style>
</head>
<body>
  <header>
    <h1>üîß XROT95 Ultimate</h1>
    <div id="status">OFFLINE</div>
  </header>

  <main>
    <section id="machineSelector"></section>
    <section id="moduleShell">
      <div id="moduleHeader">
        <h2 id="modTitle" style="margin:0; font-size:1.2rem;"></h2>
        <button onclick="closeModule()">‚Üê Zpƒõt</button>
      </div>
      <div id="moduleContent"></div>
    </section>
  </main>

  <script>
    const MACHINES = [
      { id:"XROT95", name:"Barbieri XROT 95 EVO", type:"auto", badge:"Autonomy" },
      { id:"AS940", name:"AS 940 Sherpa RC", type:"manual" },
      { id:"XCUT80", name:"Barbieri XCUT 80", type:"manual" }
    ];

    // 1. Render Menu
    const grid = document.getElementById('machineSelector');
    MACHINES.forEach(m => {
      grid.innerHTML += `
        <div class="card" onclick="loadMachine('${m.id}', '${m.type}', '${m.name}')">
          <h3>${m.name} ${m.badge ? `<span class="badge">${m.badge}</span>` : ''}</h3>
        </div>`;
    });

    // 2. Load Logic
    async function loadMachine(id, type, name) {
      document.getElementById('machineSelector').style.display = 'none';
      document.getElementById('moduleShell').style.display = 'block';
      document.getElementById('modTitle').innerText = name;
      const container = document.getElementById('moduleContent');
      container.innerHTML = '<div style="text-align:center; color:#888;">Naƒç√≠t√°n√≠ modulu...</div>';

      const file = type === 'auto' ? './modules-xrot-autonomy.js' : './modules-servicebook.js';

      try {
        const module = await import(file);
        if (module && typeof module.init === 'function') {
          await module.init(id, container, alert);
        } else {
          throw new Error(`Modul "${file}" nem√° funkci export function init()`);
        }
      } catch (err) {
        console.error(err);
        container.innerHTML = `
          <div class="error-box">
            <strong>‚ùå CHYBA NAƒå√çT√ÅN√ç:</strong><br><br>
            ${err.message}<br><br>
            <small>Zkontrolujte, zda soubor <b>${file}</b> existuje na GitHubu a zda neobsahuje chyby v k√≥du.</small>
          </div>
        `;
      }
    }

    function closeModule() {
      document.getElementById('moduleShell').style.display = 'none';
      document.getElementById('machineSelector').style.display = 'grid';
      document.getElementById('moduleContent').innerHTML = '';
    }

    // SW Register
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').then(() => console.log('SW OK'));
    }
  </script>
</body>
</html>
